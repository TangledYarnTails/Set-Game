// 81 objects(cards)
let deck =[
   {
    shape: "rhombus",
    pattern: "outline",
    color: "red",
    number: 1,
    name: "oneOutlineRedRhombus"
  },
  {
    shape: "rhombus",
    pattern: "outline",
    color: "red",
    number: 2,
    name: "twoOutlineRedRhombus"
  },
   {
    shape: "rhombus",
    pattern: "outline",
    color: "red",
    number: 3,
    name: "threeOutlineRedRhombus"
  },
  {
    shape: "rhombus",
    pattern: "striped",
    color: "red",
    number: 1,
    name: "oneStripedRedRhombus"
  },
  {
    shape: "rhombus",
    pattern: "striped",
    color: "red",
    number: 2,
    name: "twoStripedRedRhombus"
  },
   {
    shape: "rhombus",
    pattern: "striped",
    color: "red",
    number: 3,
    name: "threeStripedRedRhombus"
  },
  {
    shape: "rhombus",
    pattern: "solid",
    color: "red",
    number: 1,
    name: "oneSolidRedRhombus"
  },
  {
    shape: "rhombus",
    pattern: "solid",
    color: "red",
    number: 2,
    name: "twoSolidRedRhombus"
  },
   {
    shape: "rhombus",
    pattern: "solid",
    color: "red",
    number: 3,
    name: "threeSolidRedRhombus"
  },
    {
    shape: "rhombus",
    pattern: "outline",
    color: "green",
    number: 1,
    name: "oneOutlineGreenRhombus"
  },
   {
    shape: "rhombus",
    pattern: "outline",
    color: "green",
    number: 2,
    name: "twoOutlineGreenRhombus"
  }, 
  {
    shape: "rhombus",
    pattern: "outline",
    color: "green",
    number: 3,
    name: "threeOutlineGreenRhombus"
  },
   {
    shape: "rhombus",
    pattern: "striped",
    color: "green",
    number: 1,
    name: "oneStripedGreenRhombus"
  },
   {
    shape: "rhombus",
    pattern: "striped",
    color: "green",
    number: 2,
    name: "twoStripedGreenRhombus"
  },
   {
    shape: "rhombus",
    pattern: "striped",
    color: "green",
    number: 3,
    name: "threeStripedGreenRhombus"
  },
   {
    shape: "rhombus",
    pattern: "solid",
    color: "green",
    number: 1,
    name: "oneSolidGreenRhombus"
  },
   {
    shape: "rhombus",
    pattern: "solid",
    color: "green",
    number: 2,
    name: "twoSolidGreenRhombus"
  }, {
    shape: "rhombus",
    pattern: "solid",
    color: "green",
    number: 3,
    name: "threeSolidGreenRhombus"
  },
   {
    shape: "rhombus",
    pattern: "outline",
    color: "blue",
    number: 1,
    name: "oneOutlineBlueRhombus"
  },
  {
    shape: "rhombus",
    pattern: "outline",
    color: "blue",
    number: 2,
    name: "twoOutlineBlueRhombus"
  },
  {
    shape: "rhombus",
    pattern: "outline",
    color: "blue",
    number: 3,
    name: "threeOutlineBlueRhombus"
  },
  {
    shape: "rhombus",
    pattern: "striped",
    color: "blue",
    number: 1,
    name: "oneStripedBlueRhombus"
  },
  {
    shape: "rhombus",
    pattern: "striped",
    color: "blue",
    number: 2,
    name: "twoStripedBlueRhombus"
  },
  {
    shape: "rhombus",
    pattern: "striped",
    color: "blue",
    number: 3,
    name: "threeStripedBlueRhombus"
  },
    {
    shape: "rhombus",
    pattern: "solid",
    color: "blue",
    number: 1,
    name: "oneSolidBlueRhombus"
  },
    {
    shape: "rhombus",
    pattern: "solid",
    color: "blue",
    number: 2,
    name: "twoSolidBlueRhombus"
  },
    {
    shape: "rhombus",
    pattern: "solid",
    color: "blue",
    number: 3,
    name: "threeSolidBlueRhombus"
  },
  {
    shape: "pill",
    pattern: "outline",
    color: "red",
    number: 1,
    name: "oneOutlineRedPill"
  },
   {
    shape: "pill",
    pattern: "outline",
    color: "red",
    number: 2,
    name: "twoOutlineRedPill"
  },
   {
    shape: "pill",
    pattern: "outline",
    color: "red",
    number: 3,
    name: "threeOutlineRedPill"
  },
   {
    shape: "pill",
    pattern: "striped",
    color: "red",
    number: 1,
    name: "oneStripedRedPill"
  }, {
    shape: "pill",
    pattern: "striped",
    color: "red",
    number: 2,
    name: "twoStripedRedPill"
  },
   {
    shape: "pill",
    pattern: "striped",
    color: "red",
    number: 3,
    name: "threeStripedRedPill"
  },
   {
    shape: "pill",
    pattern: "solid",
    color: "red",
    number: 1,
    name: "oneSolidRedPill"
  },
   {
    shape: "pill",
    pattern: "solid",
    color: "red",
    number: 2,
    name: "twoSolidRedPill"
  },
   {
    shape: "pill",
    pattern: "solid",
    color: "red",
    number: 3,
    name: "threeSolidRedPill"
  },
   {
    shape: "pill",
    pattern: "outline",
    color: "green",
    number: 1,
    name: "oneOutlineGreenPill"
  },
   {
    shape: "pill",
    pattern: "outline",
    color: "green",
    number: 2,
    name: "twoOutlineGreenPill"
  },
   {
    shape: "pill",
    pattern: "outline",
    color: "green",
    number: 3,
    name: "threeOutlineGreenPill"
  },
   {
    shape: "pill",
    pattern: "striped",
    color: "green",
    number: 1,
    name: "oneStripedGreenPill"
  },
   {
    shape: "pill",
    pattern: "striped",
    color: "green",
    number: 2,
    name: "twoStripedGreenPill"
  },
   {
    shape: "pill",
    pattern: "striped",
    color: "green",
    number: 3,
    name: "threeStripedGreenPill"
  },
   {
    shape: "pill",
    pattern: "solid",
    color: "green",
    number: 1,
    name: "oneSolidGreenPill"
  },
  {
    shape: "pill",
    pattern: "solid",
    color: "green",
    number: 2,
    name: "twoSolidGreenPill"
  },
  {
    shape: "pill",
    pattern: "solid",
    color: "green",
    number: 3,
    name: "threeSolidGreenPill"
  },
  {
    shape: "pill",
    pattern: "outline",
    color: "blue",
    number: 1,
    name: "oneOutlineBluePill"
  },
  {
    shape: "pill",
    pattern: "outline",
    color: "blue",
    number: 2,
    name: "twoOutlineBluePill"
  },
  {
    shape: "pill",
    pattern: "outline",
    color: "blue",
    number: 3,
    name: "threeOutlineBluePill"
  },
  {
    shape: "pill",
    pattern: "striped",
    color: "blue",
    number: 1,
    name: "oneStripedBluePill"
  },
   {
    shape: "pill",
    pattern: "striped",
    color: "blue",
    number: 2,
    name: "twoStripedBluePill"
  },
   {
    shape: "pill",
    pattern: "striped",
    color: "blue",
    number: 3,
    name: "threeStripedBluePill"
  },
   {
    shape: "pill",
    pattern: "solid",
    color: "blue",
    number: 1,
    name: "oneSolidBluePill"
  },
   {
    shape: "pill",
    pattern: "solid",
    color: "blue",
    number: 2,
    name: "twoSolidBluePill"
  }, {
    shape: "pill",
    pattern: "solid",
    color: "blue",
    number: 3,
    name: "threeSolidBluePill"
  },
   {
    shape: "chevron",
    pattern: "outline",
    color: "red",
    number: 1,
    name: "oneOutlineRedChevron"
  },
    {
    shape: "chevron",
    pattern: "outline",
    color: "red",
    number: 2,
    name: "twoOutlineRedChevron"
  },
    {
    shape: "chevron",
    pattern: "outline",
    color: "red",
    number: 3,
    name: "threeOutlineRedChevron"
  },
    {
    shape: "chevron",
    pattern: "striped",
    color: "red",
    number: 1,
    name: "oneStripedRedChevron"
  },
   {
    shape: "chevron",
    pattern: "striped",
    color: "red",
    number: 2,
    name: "twoStripedRedChevron"
  },
   {
    shape: "chevron",
    pattern: "striped",
    color: "red",
    number: 3,
    name: "threeStripedRedChevron"
  },
   {
    shape: "chevron",
    pattern: "solid",
    color: "red",
    number: 1,
    name: "oneSolidRedChevron"
  },
     {
    shape: "chevron",
    pattern: "solid",
    color: "red",
    number: 2,
    name: "twoSolidRedChevron"
  },
     {
    shape: "chevron",
    pattern: "solid",
    color: "red",
    number: 3,
    name: "threeSolidRedChevron"
  },
     {
    shape: "chevron",
    pattern: "outline",
    color: "green",
    number: 1,
    name: "oneOutlineGreenChevron"
  },
   {
    shape: "chevron",
    pattern: "outline",
    color: "green",
    number: 2,
    name: "twoOutlineGreenChevron"
  },
   {
    shape: "chevron",
    pattern: "outline",
    color: "green",
    number: 3,
    name: "threeOutlineGreenChevron"
  },
   {
    shape: "chevron",
    pattern: "striped",
    color: "green",
    number: 1,
    name: "oneStripedGreenChevron"
  },
  {
    shape: "chevron",
    pattern: "striped",
    color: "green",
    number: 2,
    name: "twoStripedGreenChevron"
  },{
    shape: "chevron",
    pattern: "striped",
    color: "green",
    number: 3,
    name: "threeStripedGreenChevron"
  },
  {
    shape: "chevron",
    pattern: "solid",
    color: "green",
    number: 1,
    name: "oneSolidGreenChevron"
  },
   {
    shape: "chevron",
    pattern: "solid",
    color: "green",
    number: 2,
    name: "twoSolidGreenChevron"
  },
   {
    shape: "chevron",
    pattern: "solid",
    color: "green",
    number: 3,
    name: "threeSolidGreenChevron"
  },
  {
    shape: "chevron",
    pattern: "outline",
    color: "blue",
    number: 1,
    name: "oneOutlineBlueChevron"
  },
   {
    shape: "chevron",
    pattern: "outline",
    color: "blue",
    number: 2,
    name: "twoOutlineBlueChevron"
  },
   {
    shape: "chevron",
    pattern: "outline",
    color: "blue",
    number: 3,
    name: "threeOutlineBlueChevron"
  },
   {
    shape: "chevron",
    pattern: "striped",
    color: "blue",
    number: 1,
    name: "oneStripedBlueChevron"
  },
   {
    shape: "chevron",
    pattern: "striped",
    color: "blue",
    number: 2,
    name: "twoStripedBlueChevron"
  },
   {
    shape: "chevron",
    pattern: "striped",
    color: "blue",
    number: 3,
    name: "threeStripedBlueChevron"
  },
   {
    shape: "chevron",
    pattern: "solid",
    color: "blue",
    number: 1,
    name: "oneSolidBlueChevron"
  },
   {
    shape: "chevron",
    pattern: "solid",
    color: "blue",
    number: 2,
    name: "twoSolidBlueChevron"
  },
   {
    shape: "chevron",
    pattern: "solid",
    color: "blue",
    number: 3,
    name: "threeSolidBlueChevron"
  },
];
let selectedCards =[] //3 cards that were clicked on
let board = []; //12 or 15 cards on the board (3x4 grid)
let takenCards =[]; // cards that were verified that are no longer playable
let points = 0; // player's points, 1 set = 1 point, 1 wrong set = -1point
let initial = true; // initial deal is 12 cards, otherwise just 3
const cardNodeList = document.querySelectorAll(".card"); //get all card elements on board
const playerPointsSpanElement = document.getElementById("points");
const timerSpanElement = document.getElementById("timer");
const foundCounterElement = document.getElementById("found");
const addCardsElement = document.getElementById("add");
const gridContainerElement = document.getElementsByClassName("board-Wrapper");
let setCounter = 0;
function dealCards(){ //takes cards from deck and adds them to board array
let x = 0;
    if(initial == true){
//take a random index from the deck 12 times and add it to the board array
let chosen;
while(x < 12){
    chosen = Math.floor((Math.random() * deck.length ))
    board.push(deck[chosen]) //random index values from 0 to 81
deck.splice(chosen, 1) // removes one random object from the deck
assignBoardInitial();
x++;
}

}else{
//take a random index from the deck 3 times and add it to the board array
if(board.length < 15){
for(let i=0; i < 3; i++){
chosen = Math.floor((Math.random() * deck.length ))
board.push(deck[chosen]) //random index values from 0 to 81
deck.splice(chosen, 1) // removes one random object from the deck
}

}else{
  console.log("too many cards already")
}

console.log("Currently on the board: " , board)
assignBoardContinued();
}
};

function assignBoardInitial(){ //displays cards on html
  if (initial == true){
 for(let i=0 ; i < board.length ; i++){
    let x=0;
    let childArray =  Array.from(cardNodeList[i].children); // one two three
    while (x < board[i].number){
       childArray[x].style.display ="flex";
       childArray[x].classList.add(board[i].shape, board[i].pattern);
       childArray[x].style.setProperty('--this-card-color', `var(--${board[i].color})`);
       cardNodeList[i].setAttribute('id', board[i].name);
    
x++;
    }
    x= 0;
}   
  }
};

function assignBoardContinued(){
  let noIDCards=[] ; // 3 cards in this array without ids
  for(let i=0 ; i<cardNodeList.length; i++){
    if (cardNodeList[i].hasAttribute('id')){}else{
      noIDCards.push(cardNodeList[i]);

    }
  }
  console.log("cards without ids: " , noIDCards)
  for (let x=0; x<noIDCards.length; x++){
   let boardIndex = (board.length -3)+x;
    noIDCards[x].id = board[boardIndex].name;
    let childArray = Array.from(noIDCards[x].children);
    for (let y=0; y< board[boardIndex].number; y++){
      childArray[y].style.display ="flex";
      childArray[y].classList.add(board[boardIndex].shape, board[boardIndex].pattern);
      childArray[y].style.setProperty('--this-card-color', `var(--${board[boardIndex].color})`);
    }
    } 
    console.log(noIDCards);
    
  
};

function removeValidSet(takenArr) {
  initial = false;
  for (let i = 0; i < takenArr.length; i++) {
    const takenCardId = takenArr[i].id;

    // Find the index of the matching card in the board array
    const index = board.findIndex(card => card.name === takenCardId);
    if (index !== -1) {
      board.splice(index, 1);
    }

    // Find the matching DOM card and remove styles
    for (let x = 0; x < cardNodeList.length; x++) {
      if (cardNodeList[x].id === takenCardId) {
        const childrenArr = Array.from(cardNodeList[x].children);

        for (let y = 0; y < childrenArr.length; y++) {
          const classesToRemove = ['rhombus', 'pill', 'chevron', 'solid', 'striped', 'outline'];
          for (const className of classesToRemove) {
            childrenArr[y].classList.remove(className);
          }
          childrenArr[y].style.display = 'none';
        }

        cardNodeList[x].removeAttribute('id');
      }
    }
    console.log(initial)
  }
//removes border from cards
  console.log("Updated board length: " + board.length);
  for( let z=0; z <selectedCards.length; z++){
      selectedCards[z].style.border = 'none';
    }
  selectedCards = []; // resets the selected cards arr
 dealCards();
  console.log("this is the board " , board);
};

function verifySet(){
  
//if two share a characteristic and the last one does not then it is not a set
const cardZeroChildren = Array.from(selectedCards[0].children) // one two three;
const cardOneChildren =Array.from(selectedCards[1].children) // one two three;
const cardTwoChildren =Array.from(selectedCards[2].children) // one two three;

if (
  haveSameClassShape(cardZeroChildren[0],cardOneChildren[0],cardTwoChildren[0]) && // shape
  haveSameClassPattern(cardZeroChildren[0],cardOneChildren[0],cardTwoChildren[0])&&  //pattern
  haveSameColor(cardZeroChildren[0],cardOneChildren[0],cardTwoChildren[0])&& //color
  haveSameNumber(cardZeroChildren,cardOneChildren,cardTwoChildren)) { // number
  console.log("This IS a set");
      points +=1;
      playerPointsSpanElement.innerText = points;
      setCounter += 3;
      foundCounterElement.innerText = setCounter;

for(let i=0; i< 3 ; i++){
takenCards.push(selectedCards[i]) // adds valid set to taken cards array
  }
  removeValidSet(takenCards); // removes the taken cards from the board
takenCards =[];
//replace taken cards on the board

} else{
    console.log("this is NOT a set");
    points -=1;
    playerPointsSpanElement.innerText = points;
    for( let x=0; x <selectedCards.length; x++){
      selectedCards[x].style.border = 'none';
    }
    selectedCards = [];
    }
}

//adds the clicked on cards to the array of selected cards and verifies them
function addToSelectedCardsArr(){
  cardNodeList.forEach(item => {
  item.addEventListener('click', () => {
    if(selectedCards.length < 3 && !selectedCards.includes(item)){ 
      selectedCards.push(item);
      item.style.border = "2px solid blue";
    }
    if (selectedCards.length == 3){
 console.log(selectedCards);
     verifySet();
    }
    
  });
  



});

}
function haveSameClassShape(element1, element2, element3){
 const classList1 = element1.classList;
  const classList2 = element2.classList;
  const classList3 = element3.classList;
  const classShape1 = classList1[1];
  const classShape2 = classList2[1];
  const classShape3 = classList3[1];
    // Check if the current class exists in the second element's class list
    if ((classShape1 == classShape2 && classShape2== classShape3) || (classShape1 != classShape2 && classShape2!= classShape3 && classShape3!=classShape1)) {
       return true// Found a common class
    }else{
 return false// No common classes found
    }
  
}
function haveSameClassPattern(element1, element2, element3){
   const classList1 = element1.classList;
  const classList2 = element2.classList;
  const classList3 = element3.classList;
  const classPattern1 = classList1[2];
  const classPattern2 = classList2[2];
  const classPattern3 = classList3[2];
    // Check if the current class exists in the second element's class list
    if ((classPattern1 == classPattern2 && classPattern2== classPattern3) || (classPattern1 != classPattern2 && classPattern2!= classPattern3 && classPattern3!=classPattern1)) {
       return true// Found a common class
    }else{
 return false// No common classes found
    }
 
  
}
function haveSameColor(element1, element2, element3){
const color1 = element1.style.getPropertyValue('--this-card-color');
const color2 = element2.style.getPropertyValue('--this-card-color');
const color3 = element3.style.getPropertyValue('--this-card-color');
if ((color1 == color2 && color2 == color3) || (color1 != color2 && color2 != color3 && color3 != color1)){
  return true
}else{
  return false
}

}
function haveSameNumber(array1, array2, array3){
  let totalDisplay1 = 0;
  let totalDisplay2 = 0;
  let totalDisplay3 = 0;
for (let x=0; x< 3 ; x++){
  if (array1[x].style.display == 'flex'){
    totalDisplay1 +=1;
  }
   if (array2[x].style.display == 'flex'){
    totalDisplay2 +=1;
  }
  if (array3[x].style.display == 'flex'){
    totalDisplay3 +=1;
  }
}
if ((totalDisplay1 == totalDisplay2 && totalDisplay2 == totalDisplay3)||(totalDisplay1 != totalDisplay2 && totalDisplay2 != totalDisplay3 && totalDisplay3 != totalDisplay1)){
  return true
}else{
  return false
}
}
// eye functions ----------------------------------------------------------

function googlyEyes (){
// these 4 divs are children in one two and three
const rightEye = document.getElementsByClassName("right eye");
const leftEye =document.getElementsByClassName("left eye");
const leftPupil =document.getElementsByClassName("left pupil");
const rightPupil =document.getElementsByClassName("right pupil"); //html list
document.addEventListener("mousemove", (e) =>{

function updatePupil(eye, pupil){
 
   // get eye position
 const eyeRect = eye.getBoundingClientRect();
 const eyeCenterX = eyeRect.left +eyeRect.width /2;
 const eyeCenterY = eyeRect.top +eyeRect.height /2;
 //get mouse position
  const mouseX = e.clientX;
  const mouseY = e.clientY;

 //console.log(`Viewport Coordinates: X = ${mouseX}, Y = ${mouseY}`);
//caluclate direction vector from eye to the mouse
  const dx = mouseX - eyeCenterX;
  const dy = mouseY- eyeCenterY;
  //calculate distance form eye center to mouse
  const distance = Math.sqrt(dx * dx + dy * dy);
  //normalize vector
   const dirX = dx / distance;
      const dirY = dy / distance;
 
  // calculate the eye radius and max pupil movement
      const eyeRadius = eyeRect.width / 2; // because it should be a square 
      const pupilRadius = 7; // Half of the pupil size (~15px/2)
      const maxMovement = eyeRadius - pupilRadius - 3; // padding of 3px from the eye
     
      //apply the max movement constraint
      //take the min number between desitination and max distance the pupil can travel
     const sensitivity = 1.5;
const moveX = dirX * Math.min(distance * sensitivity, maxMovement);
const moveY = dirY * Math.min(distance * sensitivity, maxMovement);
    
    pupil.style.left = `calc(50% + ${moveX}px)`;
      pupil.style.top = `calc(50% + ${moveY}px)`;
 
}
for (let i = 0; i < rightEye.length; i++) {
  updatePupil(rightEye[i], rightPupil[i]);
}

for (let i = 0; i < leftEye.length; i++) {
  updatePupil(leftEye[i], leftPupil[i]);
}
 })
}

// timer stuff
const quitBtn = document.getElementById("quit");
let isRunning = false;
let secondsDisplay = document.querySelector("#seconds");
let minutesDisplay = document.querySelector("#minutes");
let hoursDisplay = document.querySelector("#hours");
let startTime;
let timerInterval;
let elapsedTime = 0;
function displayTimer(ms){

  const totalSeconds = Math.floor(ms / 1000);
  const totalMinutes = Math.floor(totalSeconds / 60);
  const totalHours = Math.floor(totalMinutes / 60);

  
  const seconds = totalSeconds % 60;
  const minutes = totalMinutes % 60;
  const hours = totalHours;

  return {
    hours: String(hours),
    minutes: String(minutes),
    seconds: String(seconds)
  };
}
function updateDisplay(){
  const currentTime = Date.now();
  elapsedTime = currentTime - startTime;
  const formatted = displayTimer(elapsedTime);
  
secondsDisplay.innerText = formatted.seconds;
minutesDisplay.innerText = formatted.minutes;
hoursDisplay.innerText = formatted.hours 

}
function startTimer(){
if (!isRunning){
  startTime =Date.now() - elapsedTime;
  timerInterval = setInterval(updateDisplay, 10);}
}
// gotta fix the stopping of the timer
function stopTimer(){
  if(isRunning){
    timerInterval = null;
    isRunning = false;
    console.log(isRunning)
  }
}


  //function calls-----------------------------------------------

startTimer();
dealCards();
addToSelectedCardsArr();
googlyEyes();
 quitBtn.onclick = stopTimer;
 addCardsElement.onclick= dealCards;
console.log(initial)